# Content, Inventory, and Commerce &#x1F4E6;

Data sources and client helpers for content, player inventory, and shop flows.

## Content
- **Ball content**: `lib/beamContent.ts` pulls `ball` type entries via Beam ContentService, caches them, and exposes `resolveBallContent` + `getKnownBalls`.
- **Mapping to game configs**: `hooks/useBallLoadout.ts` maps content to ball configs (type, color, icon, speed multiplier) and dedupes by ball type.
- **Federation marker**: Ball content entries include a `properties.external` block (`service: StellarFederation`, `namespace: StellarIdentity`) so inventory/content can be federated.
- **Defaults**: If no owned balls are found, a default ball content is granted via `stellarFederationClient.addItem`.

## Inventory
- **API wrappers**: `lib/beamInventory.ts` wraps autogenerated OpenAPI functions (`inventoryGetByObjectId`, `inventoryPutByObjectId`, etc.) for fetch, preview, apply, transfer, multipliers, and end-transaction operations.
- **Consumption**: `hooks/useCurrency.ts` reads currencies (default `currency.coin.beam_coin`), subscribes to `inventory.refresh` events when available.
- **Ball ownership**: `hooks/useBallLoadout.ts` walks the inventory shape to extract owned ball instances and types; refreshes after grants.

## Commerce
- **Store resolver**: `lib/commerceManager.ts` fetches a store (default `stores.Store_Nf` or `NEXT_PUBLIC_STORE_CONTENT_ID`), then loads listings by ID and sorts by price.
- **Caching**: Store/listings cached per `(storeContentId, manifestId)`; `forceRefresh` and `resetCommerceCache` available.
- **Hook**: `hooks/useCommerceManager.ts` handles loading state, refreshes on `refreshKey`, and logs resolved content.
- **Purchases**: `hooks/useShop.ts` calls `stellarFederationClient.purchaseBall({ purchaseId })`, then refreshes inventory.

## Wiring in Game Loop
- **TowerDestroyer** uses:
  - `useBallLoadout` for loadout, ownership, and default grants.
  - `useCurrency` for coin balance display.
  - `useCommerceManager` + `useShop` for listing retrieval and purchasing.
  - `useCoinSync` to push earned coins via `stellarFederationClient.updateCurrency`.
